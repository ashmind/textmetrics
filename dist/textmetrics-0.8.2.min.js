/* TextMetrics 0.8.2 (c) Andrey Shchekin, MIT/BSD license */
this.TextMetrics=function(a){"use strict";function l(){if(!b)return{};var a=b.getItem(d);return a?JSON.parse(a):{}}function m(){f&&b&&(b.setItem(d,JSON.stringify(e)),f=!1)}function n(){var a=document.createElement("canvas");a.width=h.width,a.height=h.height;var b=a.getContext("2d");return b.textBaseline="top",b}function o(){var a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden";var b=document.createElement("span");return a.appendChild(b),document.body.appendChild(a),b}function p(a){var b=e[a];return b||(b={},e[a]=b),b}function q(a,b,c,d){if(!d)return s(a,b,c);var e=d[a];return e||(e=s(a,b,g),d[a]=e,f=!0),{top:Math.floor(e.top*(c/g)),bottom:Math.floor(e.bottom*(c/g))}}function r(a){return" "===a||"	"===a||"\n"===a||"\f"===a||"\r"===a}function s(a,b,c){i.clearRect(0,0,h.width,h.height),i.font=c+"px "+b,i.fillText(a,0,0);for(var d=i.measureText(a).width,e=i.getImageData(0,0,d,h.height),f=e.data,g=0,j=0;j<f.length;j+=4)if(0!==f[j+3]){g=Math.floor(j/4/e.width);break}for(var k=0,j=f.length-4;j>=0;j-=4)if(0!==f[j+3]){k=Math.floor(j/4/e.width);break}return{top:g,bottom:k}}function t(a,b,c){return j.textContent=a,j.style.fontFamily=b,j.style.fontSize=c+"px",j.offsetHeight}var b;try{b=a.localStorage}catch(c){}var d="__TextMetrics_cache__",e=l(),f=!1,g=100,h={width:500,height:500},i=n(),j=o(),k={};return k.measureHeight=function(a,b,c,d){d=d||{},d.cache=void 0!==d.cache?d.cache:!0;var f,e={bottom:0,top:1e4};if(d.cache){f=p(b);var h=f.boxHeight;h||(h=t(a,b,g),f.boxHeight=h),e.box=Math.floor(h*(c/g))}else e.box=t(a,b,c);for(var i=!0,j=0;j<a.length;j++){var k=a.charAt(j);if(!r(k)){i=!1;var l=q(k,b,c,f);e.top=Math.min(e.top,l.top),e.bottom=Math.max(e.bottom,l.bottom)}}return d.cache&&m(),i&&(e.top=0,e.bottom=e.box),e},k.fitHeight=function(a,b,c,d){var e=g,f=k.measureHeight(a,c,e,d),h=f.bottom-f.top;return{fontSize:Math.floor(e*(b/h)),marginTop:Math.floor(-f.top*(b/h))}},k.measureWidth=function(a,b,c){return i.font=c+"px "+b,{box:i.measureText(a).width}},k}(this);