/* TextMetrics 0.8.1 (c) Andrey Shchekin, MIT/BSD license */
this.TextMetrics=function(a){"use strict";function k(){if(!b)return{};var a=b.getItem(c);return a?JSON.parse(a):{}}function l(){e&&b&&(b.setItem(c,JSON.stringify(d)),e=!1)}function m(){var a=document.createElement("canvas");a.width=g.width,a.height=g.height;var b=a.getContext("2d");return b.textBaseline="top",b}function n(){var a=document.createElement("div");a.style.position="absolute",a.style.visibility="hidden";var b=document.createElement("span");return a.appendChild(b),document.body.appendChild(a),b}function o(a){var b=d[a];return b||(b={},d[a]=b),b}function p(a,b,c,d){if(!d)return r(a,b,c);var g=d[a];return g||(g=r(a,b,f),d[a]=g,e=!0),{top:Math.floor(g.top*(c/f)),bottom:Math.floor(g.bottom*(c/f))}}function q(a){return" "===a||"	"===a||"\n"===a||"\f"===a||"\r"===a}function r(a,b,c){h.clearRect(0,0,g.width,g.height),h.font=c+"px "+b,h.fillText(a,0,0);for(var d=h.measureText(a).width,e=h.getImageData(0,0,d,g.height),f=e.data,i=0,j=0;j<f.length;j+=4)if(0!==f[j+3]){i=Math.floor(j/4/e.width);break}for(var k=0,j=f.length-4;j>=0;j-=4)if(0!==f[j+3]){k=Math.floor(j/4/e.width);break}return{top:i,bottom:k}}function s(a,b,c){return i.textContent=a,i.style.fontFamily=b,i.style.fontSize=c+"px",i.offsetHeight}var b=a.localStorage,c="__TextMetrics_cache__",d=k(),e=!1,f=100,g={width:500,height:500},h=m(),i=n(),j={};return j.measureHeight=function(a,b,c,d){d=d||{},d.cache=void 0!==d.cache?d.cache:!0;var g,e={bottom:0,top:1e4};if(d.cache){g=o(b);var h=g.boxHeight;h||(h=s(a,b,f),g.boxHeight=h),e.box=Math.floor(h*(c/f))}else e.box=s(a,b,c);for(var i=!0,j=0;j<a.length;j++){var k=a.charAt(j);if(!q(k)){i=!1;var m=p(k,b,c,g);e.top=Math.min(e.top,m.top),e.bottom=Math.max(e.bottom,m.bottom)}}return d.cache&&l(),i&&(e.top=0,e.bottom=e.box),e},j.fitHeight=function(a,b,c,d){var e=f,g=j.measureHeight(a,c,e,d),h=g.bottom-g.top;return{fontSize:Math.floor(e*(b/h)),marginTop:Math.floor(-g.top*(b/h))}},j.measureWidth=function(a,b,c){return h.font=c+"px "+b,{box:h.measureText(a).width}},j}(this);